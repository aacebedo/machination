{
  "variables": {
    "os_version": null,
    "architecture": null,
    "template_name": null,
    "version": null,
    "image_name": "machination-{{.template_name}}-{{.architecture}}-{{.os_version}}-ansible"
  },
  
  "builders": [
    {
      "type": "docker",
      "image": "aacebedo/ubuntu-{{user `os_version`}}-vagrant-{{user `architecture`}}",
      "export_path": "{{user `image_name`}}.tar"
    }
  ],
  "provisioners": [
    {
      "type": "shell",
      "inline":  ["apt-get install -y ansible python-apt"]
    },
	{
	  "type": "ansible-local",
	  "playbook_file": "provisioners/ansible/playbooks/{{user `template_name`}}.playbook",
	  "role_paths": ["provisioners/ansible/roles/base"],
	  "extra_arguments": ["--verbose"]
	},
	{
      "type": "shell",
      "inline":  ["apt-get remove -y ansible","apt-get autoremove -y"]
    }
  ],
  "post-processors": [
    {
      "type": "docker-import",
      "repository": "{{user `image_name`}}",
      "tag": "1.0"
    } 
  ]
  
}